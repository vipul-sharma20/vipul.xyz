<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hourly Flight Distribution</title>
    <link href="https://fonts.googleapis.com/css2?family=Gentium+Basic:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f1f1;
            color: #333;
        }

        body {
            padding: 15px 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        #chart {
            background: #f1f1f1;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        #viz {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            flex: 1;
            min-height: 0;
        }

        #viz svg {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 25px;
            color: #1a1a1a;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
            font-family: 'Gentium Basic', serif;
        }

        .tooltip {
            position: fixed;
            background: rgba(30, 30, 30, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 3px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            max-width: 250px;
        }

        .bar:hover {
            opacity: 0.7;
            cursor: pointer;
        }

        .hour-label {
            font-size: 11px;
            font-weight: 600;
            fill: #666;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px 15px;
            }

            .chart-title {
                font-size: 1.2em;
                margin-bottom: 15px;
            }

            .hour-label {
                font-size: 9px;
            }
        }

        @media (max-width: 600px) {
            .chart-title {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div id="chart">
        <div class="chart-title">Hourly Flight Distribution</div>
        <div id="viz"></div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Hourly data
        const hourlyData = [
            {"hour": 0, "count": 1, "period": "Night"},
            {"hour": 1, "count": 0, "period": "Night"},
            {"hour": 2, "count": 0, "period": "Night"},
            {"hour": 3, "count": 2, "period": "Night"},
            {"hour": 4, "count": 3, "period": "Early Morning"},
            {"hour": 5, "count": 8, "period": "Early Morning"},
            {"hour": 6, "count": 12, "period": "Early Morning"},
            {"hour": 7, "count": 9, "period": "Morning"},
            {"hour": 8, "count": 7, "period": "Morning"},
            {"hour": 9, "count": 6, "period": "Morning"},
            {"hour": 10, "count": 5, "period": "Morning"},
            {"hour": 11, "count": 8, "period": "Morning"},
            {"hour": 12, "count": 4, "period": "Afternoon"},
            {"hour": 13, "count": 6, "period": "Afternoon"},
            {"hour": 14, "count": 7, "period": "Afternoon"},
            {"hour": 15, "count": 5, "period": "Afternoon"},
            {"hour": 16, "count": 9, "period": "Evening"},
            {"hour": 17, "count": 8, "period": "Evening"},
            {"hour": 18, "count": 6, "period": "Evening"},
            {"hour": 19, "count": 4, "period": "Evening"},
            {"hour": 20, "count": 3, "period": "Night"},
            {"hour": 21, "count": 2, "period": "Night"},
            {"hour": 22, "count": 2, "period": "Night"},
            {"hour": 23, "count": 1, "period": "Night"}
        ];

        function drawChart() {
            // Clear existing chart
            d3.select('#viz').selectAll('*').remove();

            const size = 520;
            const radius = size / 2 - 65;

            const svg = d3.select('#viz')
                .append('svg')
                .attr('viewBox', `0 0 ${size} ${size}`)
                .attr('preserveAspectRatio', 'xMidYMid meet')
                .append('g')
                .attr('transform', `translate(${size/2},${size/2})`);

            // Scales - Start at 12 (top), rotate clockwise
            // Shift by Ï€ (180 degrees) so hour 12 is at top, then rotate slightly counter-clockwise
            const rotationOffset = -Math.PI / 24; // Rotate counter-clockwise by half an hour
            const angleScale = d3.scaleBand()
                .domain(hourlyData.map(d => d.hour))
                .range([Math.PI + rotationOffset, 3 * Math.PI + rotationOffset])
                .padding(0.05);

            const radiusScale = d3.scaleLinear()
                .domain([0, d3.max(hourlyData, d => d.count)])
                .range([0, radius]);

            // Color scale - muted colors by period
            const periodColors = {
                'Night': '#6B8A9B',
                'Early Morning': '#D4926E',
                'Morning': '#E0B884',
                'Afternoon': '#8A9B88',
                'Evening': '#A8838F'
            };

            const colorScale = d => periodColors[d.period];

            // Draw bars with inner radius for elevated look
            const innerRadius = 25;
            svg.selectAll('.bar')
                .data(hourlyData)
                .enter().append('path')
                .attr('class', 'bar')
                .attr('d', d3.arc()
                    .innerRadius(innerRadius)
                    .outerRadius(d => innerRadius + radiusScale(d.count))
                    .startAngle(d => angleScale(d.hour))
                    .endAngle(d => angleScale(d.hour) + angleScale.bandwidth())
                    .padAngle(0.01)
                    .padRadius(radius)
                )
                .attr('fill', d => colorScale(d))
                .on('mouseover', function(event, d) {
                    const tooltip = d3.select('#tooltip');
                    const hourLabel = `${String(d.hour).padStart(2, '0')}:00`;
                    tooltip.html(`${hourLabel}<br>Flights: ${d.count}<br>${d.period}`)
                        .style('opacity', 1);

                    // Smart positioning to keep tooltip in view
                    const tooltipNode = tooltip.node();
                    const tooltipWidth = tooltipNode.offsetWidth;
                    const tooltipHeight = tooltipNode.offsetHeight;

                    let left = event.clientX + 10;
                    let top = event.clientY - 10;

                    // Adjust if tooltip goes off right edge
                    if (left + tooltipWidth > window.innerWidth) {
                        left = event.clientX - tooltipWidth - 10;
                    }

                    // Adjust if tooltip goes off bottom edge
                    if (top + tooltipHeight > window.innerHeight) {
                        top = event.clientY - tooltipHeight - 10;
                    }

                    // Adjust if tooltip goes off top edge
                    if (top < 0) {
                        top = event.clientY + 10;
                    }

                    tooltip.style('left', left + 'px').style('top', top + 'px');
                })
                .on('mouseout', function() {
                    d3.select('#tooltip').style('opacity', 0);
                });

            // Add hour labels - every 3 hours
            const displayHours = [0, 3, 6, 9, 12, 15, 18, 21];
            const displayLabels = ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'];

            displayHours.forEach((hour, i) => {
                const angle = angleScale(hour) + angleScale.bandwidth() / 2;
                const labelRadius = radius + 52;
                const x = Math.sin(angle) * labelRadius;
                const y = -Math.cos(angle) * labelRadius;

                svg.append('text')
                    .attr('class', 'hour-label')
                    .attr('x', x)
                    .attr('y', y)
                    .attr('dy', '0.35em')
                    .attr('text-anchor', 'middle')
                    .text(displayLabels[i]);
            });

            // Add hour tick marks for all 24 hours
            for (let h = 0; h < 24; h++) {
                const angle = angleScale(h) + angleScale.bandwidth() / 2;
                const tickStart = radius + 30;
                const tickEnd = h % 3 === 0 ? radius + 37 : radius + 33;

                svg.append('line')
                    .attr('x1', Math.sin(angle) * tickStart)
                    .attr('y1', -Math.cos(angle) * tickStart)
                    .attr('x2', Math.sin(angle) * tickEnd)
                    .attr('y2', -Math.cos(angle) * tickEnd)
                    .attr('stroke', '#999')
                    .attr('stroke-width', h % 3 === 0 ? 2 : 1);
            }

            // Add circular gridlines
            const gridValues = [3, 6, 9, 12];
            svg.selectAll('.grid-circle')
                .data(gridValues)
                .enter().append('circle')
                .attr('class', 'grid-circle')
                .attr('r', d => innerRadius + radiusScale(d))
                .attr('fill', 'none')
                .attr('stroke', '#bbb')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '2,2');

            // Add grid labels overlapping the gridlines
            const labelRotation = rotationOffset / 3; // Use 1/3 of the main rotation
            svg.selectAll('.grid-label')
                .data(gridValues)
                .enter().append('text')
                .attr('class', 'grid-label')
                .attr('transform', d => {
                    const r = innerRadius + radiusScale(d);
                    const x = Math.sin(labelRotation) * r;
                    const y = -Math.cos(labelRotation) * r;
                    return `translate(${x + 5},${y})`;
                })
                .attr('dy', '0.35em')
                .attr('font-size', '9px')
                .attr('fill', '#999')
                .text(d => d);

            // Add center circle for elevated look
            svg.append('circle')
                .attr('r', innerRadius)
                .attr('fill', '#f1f1f1')
                .attr('stroke', '#bbb')
                .attr('stroke-width', 1);
        }

        // Draw chart (viewBox handles scaling automatically)
        drawChart();
    </script>
</body>
</html>
